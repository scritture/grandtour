<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Claudio Comandini">

<title>Grand Tour - Quando passa Nuvolari. Sulla morte di Lucio Dalla e il sesso degli angeli</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Grand Tour</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Ricerca"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Attiva/disattiva la navigazione" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../bookwinebar.html"> 
<span class="menu-text">BookWineBar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../catalogo.html"> 
<span class="menu-text">Catalogo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../musiche.html"> 
<span class="menu-text">Musiche</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../touristic_tour.html"> 
<span class="menu-text">Touristic tour</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../scritture.html"> 
<span class="menu-text">Scritture</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../contatti.html"> 
<span class="menu-text">contatti</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/4880518/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/tweet_scritture"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/search/scritturemagazine"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:grandtour.frascati@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Quando passa Nuvolari. Sulla morte di Lucio Dalla e il sesso degli angeli</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">comunicazione</div>
                <div class="quarto-category">Claudio Comandini</div>
                <div class="quarto-category">Lucio Dalla</div>
                <div class="quarto-category">musica</div>
                <div class="quarto-category">società</div>
                <div class="quarto-category">filosofia</div>
                <div class="quarto-category">Bologna</div>
                <div class="quarto-category">Byron</div>
                <div class="quarto-category">religioni</div>
                <div class="quarto-category">Freud</div>
                <div class="quarto-category">Lacan</div>
                <div class="quarto-category">poesia</div>
                <div class="quarto-category">sessualità</div>
              </div>
                  </div>
  </div>
  <div class="quarto-title-meta">
      <div>
      <div class="quarto-title-meta-heading">di</div>
      <div class="quarto-title-meta-contents">
               <p>Claudio Comandini </p>
            </div>
    </div>
      <div>
      <div class="quarto-title-meta-heading">Data di Pubblicazione</div>
      <div class="quarto-title-meta-contents">
        <p class="date">17 maggio 2012</p>
      </div>
    </div>
    </div>
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<div class="quarto-about-marquee content">
  <div class="about-image-container">
  </div>
  <div class="about-contents">
     <main class="content quarto-banner-title-block" id="quarto-document-content">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../images/2016/07/omaggio-alla-soglia-di-dalla-326x245.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:98.0%"></p>
</figure>
</div>
<p><em>L’arte sghemba di Lucio Dalla. Il vizio di dichiarare gli altri. La cultura gay e l’ecumenismo. Il pinkwashing. Pensare il diverso: Byron, Weininger, Adorno, Lacan. Omoerotofobia ed eterofobia. Leggi e basso ventre. Sessualità fluida e polarità di genere. Nuovo patto di socialità. «La folla attende il suo arrivo».</em></p>
<p>Celebrare il proprio compleanno da morto, in una data resa famosa come titolo di una vicenda non autobiografica, riempire con circa 5.000 persone una piazza ribattezzata con un nome diverso, sono indizi decisivi per comprendere il rapporto sghembo che l’arte di Lucio Dalla intratteneva con la realtà. La sua canzone che preferisco è <em>Nuvolari</em>, scritta con il poeta Roberto Roversi. Intelaiata da un’orchestrazione di ingranaggi ben coordinati e pulsanti, impagabile quando sul crescendo arriva a fare <em>«poltiglia»</em> dei <em>«cocci di bottiglia»</em> di montaliana memoria, conduce i suoni delle parole e la pronuncia musicale a sfiorarsi, in un equilibrio inarrivabile e a mio avviso non più ripetuto in altre prove. In questo quattro marzo, dentro la basilica di San Petronio e sotto le telecamere, un’assemblea intera si produce in un unico spasmo alla parola <em>«Grazie»</em> pronunciata da Marco Alemanno, partner delle più recenti avventure artistiche di Dalla, tra cui un brano inequivocabilmente religioso come* INRI*.</p>
<p>Una nota stonata si dilata, fino a richiedere una risoluzione. Lucia Annunziata denuncia l’omosessualità non dichiarata del musicista e cantante, e l’ipocrisia della Chiesa nel celebrarne le esequie. La giornalista era da poco reduce da un’altra gaffe ampiamente evitabile che riguardava il mondo musicale, dove per difendere le pretese messianiche di Adriano Celentano al Festival di Sanremo era riuscita ad affermare la graditissima iperbole che lo avrebbe sostenuto pure se avesse detto che gli omosessuali sarebbero dovuti andare ai forni. Un violento attacco contro Dalla è stato quindi compiuto in nome di un’insospettabile integralismo da Aldo Busi, maligno come un tumore nel dare del <em>«buffone»</em> ad un uomo semplicemente più istrione di lui, poco accorto nell’uso delle parole laddove ha diffuso addirittura come vera la falsa notizia che Dalla appartenesse all’Opus Dei.</p>
<p>Di fronte a tali goffaggini e isterismi, persino è riuscito a farci una figura egregia, ricordando che l’omosessualità non comporta necessariamente l’adesione alla cultura gay e ai suoi riti, e che nessuno è autorizzato a dichiararsi a nome di qualcun’altro. Poi, se un matrimonio omosessuale potrebbe anche avere un senso, per quanto fino a pochi anni fa fosse osteggiato come reazionario dagli stessi interessati, un funerale gay resta piuttosto incomprensibile.</p>
<p>Dove gli esponenti della Chiesa, con cui il cantante intratteneva rapporti personali, hanno pacatamente svolto il compito di amministrare le esequie, le tristi aggressive polemiche per questo mancato <em>coming-out</em> sembrano manifestare spiccate tentazioni egemoni da parte del movimento gay. Se si parla spesso dell’omosessualità diffusa nella Chiesa, bisognerà anche notare la pretesa ecumenica dei gay nella comunicazione. Riconoscere la dignità delle persone omosessuali non risparmia dal segnalare in chi parla a nome dell’intera categoria la presunzione di imporre un proprio canone, come se la ragione della diversità del reale risiedesse esclusivamente nell’identità con se stessi.</p>
<p>In questo abuso del concetto di identità, l’omosessualità diventa un valore universale apparentemente infallibile, così “ecclesiastico” da configurarsi come una specie di “papato” dei nostri tempi, che coerentemente può anche associarsi a quel sistema usato da politici e stati per rifarsi la faccia noto come <em>pinkwashing</em>, praticato dall’Israele destrorso di Nethanyau come da incolori amministrazioni italiote. Non è questo quanto serve ai diritti delle categorie meno protette e alla crescita sociale collettiva, e sembra piuttosto riguardare queinpregiudizi che tendono a diffondersi indistintamente.</p>
<p>Infatti, la realtà non è in bianco e nero. Dove esiste per ognuno un’unica e personale sessualità da coordinare con affetti e pulsioni, preferire lo stesso o il differente non cambia. Cercando per davvero di “pensare diverso”, Byron, che amava le donne come gli uomini, ci sorprende affermando che la Chiesa cattolica esprima appieno l’<em>«ermafroditismo»</em> di Roma. Weininger, più di un secolo fa, ricordava che nelle persone le gradazioni tra i poli maschile e femminile sono tali da rendere la stessa contrapposizione omosessuale-eterosessuale insensata. Adorno ci ammonisce sul fatto che il “femminile” medesimo è una costruzione omosessuale maschile, e che la famiglia è l’anello terminale del meccanismo con cui il sistema precisa i suoi condizionamenti, per cui gusti personali e composizione del nucleo non cambiano ruoli e funzioni. Lacan ci ricorda che l’amore è sempre eterosessuale, laddove riguarda l’incontro tra diversità. Insomma, la libertà è un po’ più avanti, sempre, e va bene così.</p>
<p>Inoltre, siamo poi tanto sicuri che questa società apparentemente così permissiva, ma che tende solo a creare nuove categorie di consumatori, sia libera dallo sfruttamento? Chi sfrutta chi? E quali altre domande sarebbe opportuno porsi?</p>
<p>Lucio Dalla, estroso e riservato, si faceva gli affari suoi, e tutti erano d’accordo. Lo so pure io che si pomiciava i capelloni già negli anni ’60, mentre un’attitudine propriamente definibile come pederastia sembrava piuttosto marcata. I dettagli delle sue abitudini sessuali però non dovrebbero nemmeno interessarci, ed è peraltro evidente la presenza nella sua vita di amori eterosessuali, e colpisce la capacità della sua arte di tratteggiare figure femminili mai stucchevoli. E infatti, parlare d’amore nella lingua di tutti pertiene proprio agli angeli, sul cui sesso le chiacchiere umane invano si affaticano, e che magari, come ricorda la canzone, piscerebbero tranquilli tranquilli in testa a tutti.</p>
<p>Chi non è un angelo, alla diffusa pretesa di fare bandiera di una qualsiasi presunta “identità” di orientamento sessuale esclusivista, può opporre la realtà di una sessualità di corpi senzienti le cui possibilità sono oltre ogni steccato istituito e tutte le manipolazioni possibili, la quale oltrepassa i generi eppure ne mantiene polarità e attrazione. Infatti, riconoscere la legittimità dei rapporti tra congeneri non deve inibire la ricerca delle alterità di cui il sesso è naturalmente costituito, a meno che non si voglia menomare la persona dalle possibilità di incontro: qui lo stesso Freud, peraltro contrario ad ogni discriminazione contro i gay in tempi non sospetti, può ancora aiutarci.</p>
<p>L’omofobia (più propriamente <em>omoerotofobia</em> - la parola omofobia significherebbe letteralmente “odiare il simile”, e non aiuta molto a comprendere) è una violenza: lo è però anche istigare (in forme più o meno larvate) all’omosessualità e allo stesso tempo renderla passibile di ricatto se non si osservano certe condizioni prescritte da precise associazioni di categoria. Ma soprattutto, e questo è decisivo, l’eterofobia non può e non deve costituire un criterio. Nel rispetto dei gusti personali, e pur considerando la sempre maggiore diffusione di incompletezze sessuali di ogni tipo, un mondo geneticamente indifferenziato non è auspicabile e nemmeno possibile: su questo, soccorre anche l’opinione di un indiscutibile assertore di diritti e laicità come Voltaire.</p>
<p>Non fare né misteri né parate in fatto di sesso è normale per molti. Le&nbsp;pulsioni conoscono solo esempi e rifuggono le norme, e comunque è innegabile che ogni concreta tipologia di rapporto tende oggi ad assumere un significato sociale. La legislazione mondiale si sta coerentemente impegnando nel riconoscere le unioni civili di ogni tipo, le cui esigenze crescono con i cambiamenti e per le quali vanno considerati tanto i diritti individuali e la tutela del presente, quanto le successioni e gli assetti futuri. È questo il punto decisivo, alle cui domande spesso si sfugge per rifugiarsi in uno strano conformismo. Ma laddove i rapporti tendono a svincolarsi dalla complementarietà tra generi e/o dall’aspetto riproduttivo, fino a che punto il diritto deve adeguarsi?</p>
<p>Mentre si attendono risposte, si può considerare che l’ossessione di legiferare su ogni cosa, tipica della nostra epoca, possa anche fermarsi prima del basso ventre. Preoccupazioni espresse soprattutto in ambito religioso, ma non solo, impediscono ad alcune di queste unioni di essere definite come “matrimonio”; propriamente, non essendo relazioni a base monogamica, potrebbe essere opportuno porle su un ordine legislativo specifico, sulla base di un nuovo patto di socialità, che valuti le reali esigenze delle nuove famiglie.</p>
<p>Stiamo vivendo cambiamenti enormi e serve accortezza per valutarne la portata. Saper distinguere, decidere con distacco e partecipazione, anche se la nostra influenza sulle cose sembra irrisoria, e i risultati del tutto imprevedibili, rappresentano le regole minime.</p>
<p>Intanto, l’omaggio immenso di una piazza in ascolto, appena turbato dalla ressa all’ingresso vip, sembra aver dato a Bologna qualcosa di cui essere fiera. Il surrealismo raffinato e popolare di questa grande voce è tra le parti migliori della cultura nazionale. Tuttavia, tali constatazioni non permettono di trovare nulla in grado di sostenere il rilancio di una città che sa solo compiangere il proprio degrado, che sembra essere specchio di quello di un paese intero.</p>
<p>Un <em>«gesùbambino»</em> viene seppellito, altri ne verranno. Il presente collassa su se stesso, ogni sguardo si rivolge al passato. In questo polverone, un piccolo miracolo può sempre accadere. In tempi in cui per un jazzista <em>«incapace di fare cose normali»</em> sembrava particolarmente faticoso imporsi, la commozione di questo strano compleanno in questa piazza ribattezzata era inimmaginabile. E come se davvero fosse Nuvolari, «<em>la folla attende il suo arrivo, per ore ed ore.»</em></p>
<p>[[&lt;video https://youtu.be/myjzEfTdkC0?si=DHGj4eU-2QumGeHO&gt;]]</p>
<p><em>Fotografia: Claudio Comandini, “Omaggio alla soglia di Dalla” - Bologna 2012</em></p>


</main> 
  </div>
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiato!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiato!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/grandtour\.shop");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>