<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.557">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matteo Cavallino">

<title>Grand Tour - Trump no-global contro il mondo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Grand Tour</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Ricerca"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Attiva/disattiva la navigazione" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../bookwinebar.html"> 
<span class="menu-text">BookWineBar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../catalogo.html"> 
<span class="menu-text">Catalogo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../incontri.html"> 
<span class="menu-text">Incontri</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../turismo.html"> 
<span class="menu-text">Turismo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../musiche.html"> 
<span class="menu-text">Musiche</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../scritture.html"> 
<span class="menu-text">Scritture</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../contatti.html"> 
<span class="menu-text">contatti</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/4880518/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/tweet_scritture"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/search/scritturemagazine"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:grandtour.frascati@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Trump no-global contro il mondo</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">economia</div>
                <div class="quarto-category">politica</div>
                <div class="quarto-category">geopolitica</div>
                <div class="quarto-category">USA</div>
                <div class="quarto-category">Matteo Cavallino</div>
              </div>
                  </div>
  </div>
  <div class="quarto-title-meta">
      <div>
      <div class="quarto-title-meta-heading">di</div>
      <div class="quarto-title-meta-contents">
               <p>Matteo Cavallino </p>
            </div>
    </div>
      <div>
      <div class="quarto-title-meta-heading">Data di Pubblicazione</div>
      <div class="quarto-title-meta-contents">
        <p class="date">10 marzo 2017</p>
      </div>
    </div>
    </div>
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">In questa pagina</h2>
  <ul>
  <li><a href="#la-dottrina-trump" id="toc-la-dottrina-trump" class="nav-link active" data-scroll-target="#la-dottrina-trump">1. La dottrina Trump</a></li>
  <li><a href="#crescita-globale-a-rischio" id="toc-crescita-globale-a-rischio" class="nav-link" data-scroll-target="#crescita-globale-a-rischio">2. Crescita globale a rischio</a></li>
  <li><a href="#lo-spettro-del-super-dollaro" id="toc-lo-spettro-del-super-dollaro" class="nav-link" data-scroll-target="#lo-spettro-del-super-dollaro">3. Lo spettro del super dollaro</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<div class="quarto-about-marquee content">
  <div class="about-image-container">
    <img src="/images/2017/03/Rebel-Trump.jpg" class="about-image " style="width: 100%;">
  </div>
  <div class="about-contents">
     <main class="content quarto-banner-title-block" id="quarto-document-content">

<p><em>Mentre per i Paesi emergenti si profila il rischio di una pericolosa crisi debitoria, l’<a href="http://www.lindro.it/lisolazionismo-trump-un-muro-verso-la-presidenza/">isolazionismo</a></em> <em>del nuovo presidente americano sembra incapace di proporre soluzioni, tanto per i flussi migratori, quanto per le nuove povertà interne, restando così confinato, oltre che ad un apprezzamento del dollaro minaccioso nei confronti della crescita globale, a banali proclami da social. Il problema politico che sembra generalmente ormai imporsi, e non soltanto negli USA, riguarda la difficoltà di scegliere tra efficacia decisionale e allargamento della rappresentanza; le misure diventano ambedue deleterie laddove si assimilano al populismo. E se la democrazia americana sembra esposta in modo piuttosto peculiare al degenerare in «dittatura della maggioranza», come già evidenziato da Tocqueville, il Paese sembra scontare anche il peso di due emergenze: il fallimento delle pretese imperiali della sua politica estera, quanto la definitiva sostituzione della comunicazione alla politica. Il primo aspetto rivela una pulsione revisionista e autolesionista piuttosto viva e dettata anche dall’arretramento dei profitti delle multinazionali, per soddisfare la quale il presidente non però ha affatto potere, laddove restano a limitarlo le prerogative del Congresso (<a href="http://www.limesonline.com/cartaceo/la-sensibilita-imperiale-degli-stati-uniti-e-il-destino-del-mondo?prv=true">Dario Fabbri, “La sensibilità imperiale degli Stati Uniti è il destino del mondo”, «Limes» 2/2017</a>); inoltre, le possibilità relative alla riduzione dei conflitti in Medio Oriente e dei finanziamenti alla NATO sono già state ampiamente vanificate,&nbsp;risolvendosi interamente in mere promesse elettorali, facendo comprendere la pericolosa rilevanza del secondo aspetto. Infatti, è ormai evidente che il predominio della comunicazione, solennizzato con la formula di “post-verità”, è tutto meno che democratico; per essere contenuto, esige ad ogni livello il recupero del ruolo delle competenza professionali e tecniche, formulando una <a href="http://www.scritture.net/mag/il-disgusto-della-democrazia/index.html">tecnocrazia democratica</a> capace di portarci oltre le delusioni dei radicalismi di maniera e i facili miti della democrazia diretta del populismo. E proprio con Trump, capace di riciclare vecchi slogan no-global per politiche reazionarie, il populismo svela di essere maschera di un particolarismo neoprotezionista tutto a favore dei ceti dominanti, come evidenzia un <a href="https://stores.streetlib.com/it/search?publisher=Valori">dossier</a> pubblicato dalla rivista “Valori”. Di fronte a questa e altre incongruenze, c’è da chiedersi se questo bizzarro presidente riuscirà ad arrivare a fine mandato.</em></p>
<section id="la-dottrina-trump" class="level2">
<h2 data-anchor-id="la-dottrina-trump">1. La dottrina Trump</h2>
<p>Tra i capisaldi della dottrina Trump, un elemento in particolare è sembrato emergere con forza alle prime battute della lunga campagna elettorale: l’avversione ideologica nei confronti della globalizzazione. Nei mesi che hanno preceduto la sua elezione, il magnate statunitense ha promesso di imporrei un dazio del 45% sulle importazioni cinesi accusando ufficialmente Pechino di manipolazioni della valuta.</p>
<p>Ma le critiche, come noto, si sono estese anche al Messico, così come ai trattati commerciali in essere e a quelli in divenire. Il neo inquilino della Casa Bianca ha espresso l’intenzione di rivedere i dettagli del Nafta, l’intesa tra USA, Canada e Messico in vigore dal 1994, senza escludere, nella peggiore delle ipotesi, un’abrogazione dell’accordo.</p>
<p>Nel mentre, ha sostanzialmente affossato le discussioni sul TTIP - l’accordo di libero scambio con l’Europa - e ha definito a Trans-Pacific-PArtenership (TPP), il piano regolamentare sugli investimenti che coinvolge dodici Paesi dell’area Asia-Pacifico, <em>«uno stupro per gli Stati Uniti»</em>.</p>
<p>Retorica acchiappavoti? Può darsi, ma l’ipotesi di nuove strategie protezioniste resta comunque concreta. Con conseguenze davvero rilevanti anche a fronte di provvedimenti più leggeri rispetto a quelli annunciati.</p>
</section>
<section id="crescita-globale-a-rischio" class="level2">
<h2 data-anchor-id="crescita-globale-a-rischio">2. Crescita globale a rischio</h2>
<p>Sotto i riflettori, in primo luogo, c’è il futuro delle relazioni con la Cina, che nel 2015 - l’ultimo anno per il quale sono disponibili dati definitivi - ha introdotto in America prodotti di consumo, semilavorati e materie prime per quasi mezzo trilione di dollari.</p>
<p>Ma i timori degli analisti si estendono anche all’economia globale. Willem Buiter, capo economista di Citigroup, ripreso da Business Insider, ritiene che le scelte di Trump potrebbero tradursi un una vera e propria guerra commerciale <em>«capace di innescare facilmente una recessione planetaria»</em>; Deutsche Bank, in una nota dell’11 novembre scorso, ha definito <em>«la possibile svolta protezionista»</em> della Casa Bianca come <em>«la principale minaccia alla crescita globale»</em>.</p>
<p>Secondo il chief economisti della divisione USA di Barclays, Michael Gapen, infine, il rafforzamento delle barriere commerciali potrebbe avere anche importanti ricadute per la stessa economia americana.</p>
<p>Innalzare al 15% i dazi sui prodotti cinesi a al 7% quelli sui beni messicani (entrambi soggetti, oggi, a tariffe comprese tra il 2 e il 19% a seconda del tipo di merci), ha spiegato in una recente nota alla clientela, potrebbe costare al PIL statunitense circa mezzo punto percentuale. Ovvero, un quarto del tasso di crescita previsto per il 2017.</p>
</section>
<section id="lo-spettro-del-super-dollaro" class="level2">
<h2 data-anchor-id="lo-spettro-del-super-dollaro">3. Lo spettro del super dollaro</h2>
<p>In prima fila ad attendere le temute decisioni di Trump, ci sono, idealmente, i cosiddetti mercati emergenti. Nel 2016, evidenziano le stime del Fondo Monetario Internazionale, il loro tasso di crescita si sarebbe attestati al 4,2% conto l’1,6% delle economie mature. Ma il contesto, si sa, è fatto di luci e ombre. Buona parte dell’espansione complessiva viene infatti dall’Asia, ormai impegnata in una corsa solitaria.</p>
<p>L’America Latina, per contro, ha chiuso in recessione mentre l’Africa Subsahariana ha sperimentato un aumento del PIL pari all’1,4%, il livello più basso dal 1994. Tutte le aree in esame, però, sembrano avere una preoccupazione in comune: un ulteriore, eccessivo e insostenibile rialzo del dollaro. E anche qui, ovviamente, non si può non parlare di effetto-Trump.</p>
<p>Il neo-inquilino della Casa Bianca ha promesso di contribuire al rilanci dell’economia attraverso nuovi investimenti infrastrutturali, una strategia con annessi rischi inflazionistici che implica, ovviamente, la scontata contromossa della FED.</p>
<p>Lo scorso 18 novembre, l’aspettativa di un imminente rialzo dei tassi - materializzatosi puntualmente un mese dopo - era già stato sufficiente a spingere l’ICE Dollar Index, un indicatore del valore del biglietto verde basato su un paniere di sei diverse valute, a quota 100.53, il livello più altro dall’aprile 2003.</p>
<p>Se la tendenza dovesse essere confermata, il rischio è che a patire le conseguenze peggiori siano in primo luogo i Paesi emergenti e in via di sviluppo, i cui debiti, spesso contratti in dollari, diventano automaticamente più costosi da restituire. I primi segnali d’allarme si stanno già manifestando in Africa, dove negli ultimi anni sono cresciute le emissioni di titoli di Stato in valuta estera (e dove i titoli di stato reagiscono male al successo di Trump e alle prospettive di apprezzamento del dollaro).</p>
<p>Ma il problema riguarda ovviamente le “nuove economie” nel loro insieme. All’inizio del 2016, segnala la Banca dei Regolamenti Internazionali, il debito denominato in valuta americana dei governi e delle società private (banche escluse) dei paesi emergenti valeva 3,2 trilioni di dollari, quasi il doppio rispetto all’ammontare registrato nel 2009. Da qui al 2018, ha ricordato Bloomberg, le compagnie private dovranno saldare oltre il 10% della cifra (340 miliardi) facendo i conti, con ogni probabilità, con un cambio più favorevole.</p>
<p>Una prospettiva poco incoraggiante. <em>«Gli investitori del comparto obbligazionario prendano nota»</em>, scrive Bloomberg. <em>«Non è esagerato pensare che questa svendita del debito dei mercati in via di sviluppo possa peggiorare con conseguenze di vasta portata sui mercati di tutto il mondo»</em>.</p>
<p>•</p>
<p><em>Matteo Cavallito, “Il Trump no-global minaccia il mondo”, «Valori» a. 17 n.&nbsp;145, febbraio 2017, pp.&nbsp;16-17.</em></p>


</section>
</main> 
  </div>
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiato!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiato!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/grandtour\.shop");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>