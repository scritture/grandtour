<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stefano Feltri">

<title>Grand Tour - Tutti contro il TTIP. E poi?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Grand Tour</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Ricerca"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Attiva/disattiva la navigazione" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../diario.html#category=Claudio Comandini"> 
<span class="menu-text">Claudio Comandini</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../scritture.html"> 
<span class="menu-text">Scritture</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../contatti.html"> 
<span class="menu-text">contatti</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/4880518/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/tweet_scritture"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/search/scritturemagazine"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:grandtour.frascati@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Tutti contro il TTIP. E poi?</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">economia</div>
                <div class="quarto-category">geopolitica</div>
                <div class="quarto-category">politica</div>
                <div class="quarto-category">società</div>
              </div>
                  </div>
  </div>
  <div class="quarto-title-meta">
      <div>
      <div class="quarto-title-meta-heading">di</div>
      <div class="quarto-title-meta-contents">
               <p>Stefano Feltri </p>
            </div>
    </div>
      <div>
      <div class="quarto-title-meta-heading">Data di Pubblicazione</div>
      <div class="quarto-title-meta-contents">
        <p class="date">27 maggio 2016</p>
      </div>
    </div>
    </div>
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<div class="quarto-about-marquee content">
  <div class="about-image-container">
    <img src="/images/2016/06/Tutti-contro-il-TTIP-640x381.jpg" class="about-image " style="width: 100%;">
  </div>
  <div class="about-contents">
     <main class="content quarto-banner-title-block" id="quarto-document-content">
<p><em>Nella Germania da tempo pienamente riabilitata come potenza europea ma ormai ad ad un passo dal perdere la proprio semi-egemonia europea, si è svolta in ottobre la prima grande manifestazione contro il trattato di commercio trans-atlantico denominato TTIP. Ancora in fase di discussione, il trattato ha già conosciuto fasi di forte contrapposizione interna per le incompatibilità normative che USA e UE riconoscono su alimentazione, sanità e cosmesi. Infatti, come è riscontrabile anche dall’analisi diretta dei <a href="http://www.waronwant.org/media/massive-document-leak-spells-end-ttip">documenti</a>, rispetto alla tutela delle denominazioni di origine, al mantenimento dei servizi pubblici, alle sperimentazioni sugli animali. Per molti motivi, è diverso contestare il TTIP e sarebbe opportuno gestirlo diversamente: va però considerato che è un processo già in corso da decenni, comunque inevitabile. Il contesto nel quale viene formulato è quello per cui l’egemonia americana sta tramontando e la critica unità dell’Europa è appesa soprattutto al suo interesse. Il tentativo strategico di salvaguardare la prevalenza commerciale e geopolitica dell’Occidente si traduce così nell’obbligo di applicare leggi fatte sulla pelle di popolazioni che non hanno altra prospettiva oltre quella di protestare contro se stesse. ll problema dell’Europa è quello di non avere alcuna coesione interna e di perdere i pezzi anche sul poco che si ritrova; quello dell’America è di far approvare il trattato prima delle elezioni che potrebbero portare alle elezioni di Trump, che tra le altre bizzarrie è intenzionato a chiudere la porta in faccia a quelli che definisce come “scrocconi europei”. Ad un occhio superficiale, il &nbsp;candidato repubblicano si assimilerebbe alla più austera signora Clinton proprio per l’opposizione al TTIP: tuttavia, se il primo è contrario in nome degli interessi dei monopoli e della classe media, la seconda&nbsp; fa opposizione per essere all’altezza dei competitori democratici: segno questo che le distinzioni da fare sono molte. Infatti, ad essersi opposti alle pretese USA sono proprio esponenti della tanto contestata UE, che ha già permesso l’attuazione di politiche ambientali quali energia solare e differenziazione dei rifiuti. Le trattative sono in stallo così anche per le incompatibilità normative che USA e UE riconoscono su alimentazione, sanità e cosmesi: con tutti i suoi limiti, l’Europa intende mantenere le tutele di denominazioni di origine, disponibilità dei dei servizi pubblici, divieti di sperimentazioni sugli animali; se avesse una testa, l’Europa potrebbe puntare di più i piedi, tanto più che il TTIP è propriamente un processo, in corso da decenni, inevitabile nella prospettiva globale. il paradosso è che se&nbsp; la UE ha maggiore potere contrattuale nei confronti degli USA, sono proprio questi a pretendere una maggior unità del vecchio continente in modo da facilitare le trattative; tale preoccupazione è poi condivisa anche da altri referenti quali la Cina e la Russia, in piena competizione con gli stessi USA. Tuttavia, la percezione pubblica delle complesse questioni che accompagnano il TTIP sono in sensibile ritardo, e assimilano l’ingenuità degli antagonismi di maniera a populismi reazionari ancora più pericolosi, rendendo ancora più incerto se se sia peggiore un cattivo trattato oppure il ristagno nell’incapacità di uscire dalla crisi. Occorre così continuare a tenere gli occhi aperti, perché la situazione è in continuo cambiamento.</em></p>
<p>Gli ISDS servono a proteggere gli investimenti delle compagnie straniere in un Paese che poi può cambiare le regole e distruggere il valore di quell’investimento. Uno dei casi che ai NO-TTIP piace citare è quello della Germania che dopo il disastro di Fukushima del 2011 all’improvviso cambia idea sul nucleare: il gruppo Vattenfall ora chiede 4,7 miliardi di euro di risarcimenti per il danno subito, l’arbitrato è in corso. Grande polemica ha suscitato anche il <a href="http://www.rinnovabili.it/energia/isds-spalma-incentivi-333/">ricorso alla procedura Isds per tagli retroattivi decisi nel 2011 agli incentivi alle energie rinnovabili</a> nell’ambito del quale l’Italia si era sfilata dal Trattato sulla Carta Energia. Questi sono esattamente i casi per cui strumenti come gli ISDS sono stati pensati: un’azienda programma investimenti pluridecennali sulla base delle regole fissate da uno Stato sovrano e dei suoi impegni presi a livello internazionale e poi quello Stato cambia idea, riscrive le regole e distrugge il business plan dell’impresa.</p>
<p>È chiaro che se vogliamo ricevere investimenti stranieri (so che alcuni dei commentatori qui sono per l’autarchia e la decrescita felice, ma la gente normale vuole ancora avere un lavoro) dobbiamo dare qualche garanzia a chi spende miliardi nei nostri Paesi. Il governo tedesco di Angela Merkel, filo-nucleare fino a un attimo prima, ha tutto il diritto di rinunciare all’atomo. Ma deve sapere che quella scelta ha un costo, cioè il rischio di dover risarcire chi ha costruito le centrali, perdita di posti di lavoro e così via. Come dicono gli economisti, nessun pasto è gratis.</p>
<p>Quindi è propaganda scorretta dire che <em>«gli Stati non vincono mai»</em>, visto che la procedura ISDS e altri arbitrati analoghi servono a tutelare gli investimenti e, dunque, gli investitori. È come dire che in una class action all’americana le multinazionali sono vittime perché non possono mai spennare i consumatori ma al massimo riescono a evitare risarcimenti miliardari.</p>
<p><a href="https://www.rijksoverheid.nl/documenten/rapporten/2014/06/24/the-impact-of-investor-state-dispute-settlement-isds-in-the-ttip">Uno studio del ministero del Commercio olandese</a> basato su dati Ocse 2012, ha censito 274 denunce da ISDS: il 43 per cento è stato deciso in favore dello Stato, il 31 per cento a favore dell’investitore, il 26 per cento si è chiuso con un accordo. <a href="http://unctad.org/en/PublicationsLibrary/webdiaepcb2015d1_en.pdf">Dati più aggiornati del 2014, citati anche dai no-Ttip</a> dicono che su 365 casi di ISDS, il 37 per cento sono stati decisi a favore dello Stato, il 25 per cento a favore dell’investitore.</p>
<p>Quindi, in sintesi, nei contenziosi tra Stato e multinazionali vince più spesso lo Stato. A volte le multinazionali vincono, certo,<a href="http://www.ilfattoquotidiano.it/2016/05/25/ttip-caro-feltri-contro-gli-investitori-i-governi-non-vincono-mai/2761401/">l’agenzia Onu Unctad parla di un successo da 50 miliardi di dollari a favore degli investitori in tre casi collegati tra loro</a>. Sono tanti soldi. Ma quale sarebbe il danno – in termini di mancati investimenti stranieri – se si rinunciasse a ogni forma di tutela delle multinazionali disposte a investire? Calcolo complesso.</p>
<p>Per come impostano la questione gli anti-TTIP, ogni strumento di difesa degli investimenti è sbagliato perché viola la sovranità democratica. Mi sembra un ragionamento molto miope: noi siamo cittadini di un Paese dove (poche) multinazionali investono, ma siamo anche azionisti, finanziatori o dipendenti di aziende che vanno all’estero a cercare opportunità. E non ci piace quando gli investimenti italiani vengono espropriati, danneggiati o boicottati. Se si vuole discutere invece di come deve essere fatta la corte arbitrali, di quali garanzie ci devono essere per evitare conflitti di interesse o “cattura” degli arbitri da parte delle multinazionali ecc. è molto interessante e ne ho parlato <a href="http://www.ilfattoquotidiano.it/2016/05/23/ttip-davvero-saremo-colonie-delle-multinazionali-con-gli-isds/2752697/">nell’ultimo post</a>.</p>
<p>Ma l’ostilità verso ogni strumento di giurisdizione internazionale è assurda. Aboliamo anche la Corte di giustizia europea? E la Corte europea dei diritti dell’uomo? Anche quelle interferiscono con la sovranità nazionale.</p>
<p>A esagerare con la demagogia, si arriva all’assurdo logico contenuto sempre nell’ultimo post degli anti-TTIP, che sono pronti alla rivoluzione per evitare che la carne agli ormoni americana arrivi in Europa ma poi denunciano indignati: <em>«Se si approfondisse meglio come funzionano ambiti di questo tipo, magari si capirebbe come l’Unione Europea dovette pagare centinaia di milioni di dollari in ritorsioni commerciali dagli Stati Uniti per aver impedito l’entrata di carni agli ormoni dalla fine degli anni Novanta»</em>.</p>
<p>Ragazzi, decidetevi. Se volete bloccare la carne agli ormoni che gli Usa vorrebbero tanto esportare da noi (costa meno), allora dovreste essere orgogliosi e rassicurati dal fatto che la Commissione europea si è dimostrata pronta a una guerra commerciale con gli Usa pur di difendere il principio di precauzione (non siamo sicuri che un certo prodotto faccia male, ma non abbiamo neppure la prova del contrario e nel dubbio la vietiamo). Negli ultimi 15 anni gli&nbsp;Usa hanno lanciato un’offensiva tariffaria per vendetta contro l’Europa, nella speranza che cedesse sugli ormoni. Non è successo.</p>
<p>E, <a href="http://www.europarl.europa.eu/news/it/news-room/20120314IPR40752/Finita-la-guerra-sulla-carne-agli-ormoni">come spiega il Parlamento europeo</a>: <em>«Nel maggio 2009 è stato firmato un accordo negoziato dalla Commissione europea e dal governo degli Stati Uniti che prevedeva un meccanismo in due fasi per ridurre progressivamente il livello delle sanzioni imposte dagli Stati Uniti sui prodotti dell’UE, mentre l’Unione ha progressivamente aumentato le quantità importabili nell’UE per le carni bovine di “alta qualità” prive di ormoni. Gli Stati Uniti hanno già deciso di revocare le sanzioni imposte ai prodotti europei nel maggio 2011.&nbsp;I principali beneficiari della revoca delle sanzioni da parte degli Stati Uniti e del Canada sono l’Italia, con un valore commerciale di oltre 99 milioni di dollari, la Polonia con 25 milioni di dollari, la Grecia e l’Irlanda entrambe con 24 milioni di dollari, la Germania e la Danimarca entrambe con 19 milioni di dollari, la Francia con 13 milioni di dollari e la Spagna con 9 milioni di dollari».</em></p>
<p>In base a una serie di deduzioni un po’ labili, gli anti-TTIP sostengono che la Commissione voglia (non si capisce perché) far entrare la carne agli ormoni con il TTIP. Tutti ma proprio tutti i negoziatori e i loro referenti politici lo hanno escluso, il mandato negoziale dell’Europarlamento (che dovrà dare il voto finale) è categorico sul punto. Ma gli anti-TTIP sono convinti del contrario. Da giornalista mi devo occupare dei fatti, i dogmi di fede li lascio a sacerdoti e fedeli.</p>
<p>•</p>
<p><em><a href="http://www.ilfattoquotidiano.it/2016/05/26/ttip-e-isds-come-la-campagna-contro-il-trattato-distorce-le-informazioni/2764549/">Stefano Feltri, “TTIP e ISDS: come la campagna contro il trattato distorce le informazioni”, «Il Fatto Quotidiano» 26.05.2016.</a></em></p>
<p><em>Fotografia: Claudio Comandini, “Tutti contro il TTIP” - Berlino, ottobre 2015.</em></p>


</main> 
  </div>
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiato!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiato!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/grandtour\.shop");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>