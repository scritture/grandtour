<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="it" xml:lang="it"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Claudio Comandini">

<title>L’Italia ha vinto – Grand Tour</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nessun risultato",
    "search-matching-documents-text": "documenti trovati",
    "search-copy-link-title": "Copiare il link nella ricerca",
    "search-hide-matches-text": "Nascondere i risultati aggiuntivi",
    "search-more-match-text": "ci sono altri risultati in questo documento",
    "search-more-matches-text": "ulteriori risultati in questo documento",
    "search-clear-button-title": "Pulire",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancellare",
    "search-submit-button-title": "Inviare",
    "search-label": "Ricerca"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Grand Tour</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Ricerca"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Attiva/disattiva la navigazione" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../bookwinebar.html"> 
<span class="menu-text">BookWineBar</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../catalogo.html"> 
<span class="menu-text">Catalogo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../incontri.html"> 
<span class="menu-text">Incontri</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../turismo.html"> 
<span class="menu-text">Turismo</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../musiche.html"> 
<span class="menu-text">Musiche</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../scritture.html"> 
<span class="menu-text">Scritture</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../contatti.html"> 
<span class="menu-text">contatti</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/groups/4880518/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/tweet_scritture"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/search/scritturemagazine"> <i class="bi bi-facebook" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:grandtour.frascati@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">L’Italia ha vinto</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">narrazioni</div>
                <div class="quarto-category">musica</div>
                <div class="quarto-category">società</div>
                <div class="quarto-category">Basso impero</div>
                <div class="quarto-category">Frascati</div>
                <div class="quarto-category">Roma</div>
                <div class="quarto-category">Claudio Comandini</div>
              </div>
                  </div>
  </div>
  <div class="quarto-title-meta">
      <div>
      <div class="quarto-title-meta-heading">di</div>
      <div class="quarto-title-meta-contents">
               <p>Claudio Comandini </p>
            </div>
    </div>
      <div>
      <div class="quarto-title-meta-heading">Data di Pubblicazione</div>
      <div class="quarto-title-meta-contents">
        <p class="date">25 luglio 2012</p>
      </div>
    </div>
    </div>
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<div class="quarto-about-marquee">
  <div class="about-image-container">
    <img src="/images/2016/07/forza-italia.jpg" class="about-image " style="width: 100%;">
  </div>
  <div class="about-contents">
     <main class="content quarto-banner-title-block" id="quarto-document-content">
<p><em>Dove si vince la partita e si incontrano quattramicialbar a fare festa e sono funerali di stato. Dal romanzo “Basso Impero”.</em></p>
<p>«Cosa significano queste carte?»</p>
<p>«Servono per vedere il futuro.»</p>
<p>La partita procedeva da un quarto d’ora e già era stanca. Ingiurie erano dedicate a tutti i partecipanti al gioco, con rare incitazioni in forma d’insulto. Non era una partita di quelle che stai attizzato.</p>
<p>«E che vuol dire ?»</p>
<p>«Il Folle, il Diavolo, il Giudizio rovesciato, la Torre pure, la Morte. Perdiamo.»</p>
<p>«E ci volevano le carte per capirlo?»</p>
<p>«Ci vediamo qualche filmetto?»</p>
<p>«Faccio una canna.»</p>
<p>«Un’altra? Dammi una carta da cento.»</p>
<p>«E chi ce l’ha. Da mille. Fare comunque canna.»</p>
<p>«Arrotolala intanto.»</p>
<p><a href="https://soundcloud.com/claudio_comandini/litalia-ha-vinto">Pippano pippano e strapippano.</a> Arriva il gol della Nigeria. A Porkoskin va di traverso. Soffia sullo specchio accuratamente rifinito di striscioline bianche, e la polveretta va tutta intorno nel salotto buono.</p>
<p>«Cretinodeficentepezzodimerdaidiotaimbecillefrocio!»</p>
<p>«Ma questi cazzo di negri…»</p>
<p>Senza prodursi in ulteriori spropositi, si pippano tutto il salotto buono, lo spolverano infilando il naso in ogni angolo e in ogni fibra, regrediscono a livelli futuribili. E restano catodici svariati minuti. Poi, la frenesia s’esterna.</p>
<p>«Senti…» «Non ho voglia, Lele. Non ora.»</p>
<p>«Dai che ti va più che ha me.»</p>
<p>Si avvicina e gli si mette sopra.</p>
<p>Quella vittoria non se l’era aspettata nessuno, ma tutti trovarono l’obbligo di festeggiarla. Ogni piazza invasa da un tumulto di grida e bandiere, caroselli isterici per un gol all’ottantanovesimo minuto e un altro ai supplementari contro la Nigeria, in vantaggio dal ventesimo. E come in tutte le città del paese, la piazza di decibel impazzita, sul corso parate con donne bruttissime inelegantemente mascherate da bandiera italiana, e tuffi in fontane, scalate ai monumenti, gente che butta i rifiuti dalla finestre, atti vandalici generici.</p>
<p>Pure il tossico è felice, e con un mantello bianco rosso e verde e la mano stesa fa davvero una bella figura. Le crickcrok sono patriotticamente vestite con la maglia dei giocatori della nazionale. Sullo spartitraffico, assediato da vetture d’ogni sorta in caroselli di tripudio tricolore, si incontrano Giggi, che ha visto la partita al bar insieme a tutti ed è entusiasta, con Lele, che ha appena fatto una strage, e Porkoskin, inevitabilmente complice.</p>
<p>Mentre Porkoskin stava sbocchinando il cazzo sporco di merda di Lele che se l’era inculato, i genitori di Lele si sparavano. E quindi lui uccide la madre che ha ucciso il padre: durante il tifo gli spari non si distinguono. Poi prende soldi, libretto degli assegni, carte di credito, gioielli, oro e pistola e se ne va.</p>
<p>Mentre sono in piazza a pianificare, entra in scena Mario in un Maserati pieno di bandiere. Con un urlo e due trombette da stadio, annuncia l’intenzione di andare a fare giustizia in città per festeggiare il furto dell’automobile e la sconfitta degli sporchi negri.</p>
<p>«Ma ’ndo l’hai rimediato ?»</p>
<p>«Lo ’nculato a uno che era andato a pià il giornale e figurate&nbsp; se co la partita lo cercavano! Eh eh eh!»</p>
<p>«Il 190?»</p>
<p>«Fuso. Rimasto a Vermicino. Nu’ rompete li cojoni, ’namo.»</p>
<p>Per arrivare alla città c’è una sola strada che conosce tante deviazioni. Qui il paesaggio si offre inconsueto, con luoghi che potrebbero essere ovunque, e quasi sembra di essere condotto in altre città. Queste deviazioni riportano poi improvvise alla vista rassicurante delle grandi piazze, da cui poi si snodano altri percorsi, dentro la stessa e in altre città.</p>
<p>Ad uno degli incroci di queste strade c’è Abdul, dal Togo. Non sa come stanno i suoi figli, sua moglie. Manda loro i soldi, centocinquantamila al mese dal guadagno al semaforo. Un terzo le tiene per se. Qualcuno dice che i suoi guadagni sono più alti e che non paga le tasse, e che a furia di pulirli i vetri si sporcano di più. Dorme alle rovine dell’acquedotto Felice. Non è mai invadente, ringrazia, ed augura la buona fortuna agli automobilisti, sempre.</p>
<p>Presso le arcate è stato trovato il suo corpo carbonizzato, col cranio spaccato, e tre colpi in pieno petto inferti successivamente al suo decesso. L’Italia aveva vinto, e con i rumori dei festeggiamenti non se ne sarebbe accorto nessuno.</p>
<p>A Porkoskin l’hanno lasciato a maledire il giorno che continua a sorgere seminando massacri. È stato lui a terminare Abdull, per pietà, dopo che gli avevano dato fuoco, e visto contorcersi urlando. Adesso il coraggio per terminare se stesso non lo trova. L’unica cosa sensata da fare, e non gli riesce. Lele è scappato con gli altri, la pistola gli è rimasta in tasca per sbaglio, ora la getterà via da qualche parte.</p>
<p>Verranno le guardie, lo porteranno al gabbio, questa volta non può inventarsi storie. Ma non farà i nomi. Non è un infame. E l’Italia ha vinto.</p>
<p>Gli altri si ammazzano contro un muro mentre vanno a prendere i cornetti correndo a centoventi all’ora. Sopravvive solo Giggi che all’ospedale si fa un sacco di amici e passa la giornata a vedere la televisione ed organizzare serate e businesse.</p>
<p>Funerali di stato di Abdull, a reti unificate, discorso delle più alte autorità. Giggi riconosce:</p>
<p>«Hanno fatto bene a dare spazio a quelle cose importanti e a quella brava persona, che io ho pure conosciuto».</p>
<p>E già che c’è, si incazza, come tutte le brave persone,&nbsp;e pontifica, con consenso unanime:</p>
<p>«Quell’infamata del decreto Biondi, che rimette in libertà tutti i ladri. Che io l’ho puro votati questi, perchè erano quello che ci voleva per risollevà l’Itaglia. Intanto la brava gggente more e l’infami prospereno, e ce rovinano puro la soddisfazione delle partite che uno vince perché se lo merita. Ma Forza Itaglia e daje e daje che io c’ho la speranza che tutte le persone oneste come noi possano un giorno sconfiggere tutta l’ipocrisia del mondo, ecc..»</p>
<p>Non si capisce se finge o se non ricorda o se proprio non si rende conto. Neanche quando vengono le guardie e gli annunciano il trasferimento.</p>
<p>Porkoskin già da una misura di tempo per lui incalcolabile è in cella d’isolamento a Regina Coeli, dove cinque presunti banditi su sei sono extracomunitari e due sono scuri scuri. Ogni tanto lasciano qualcuno dopo mesi perché innocente, ma comunque qui tutti dicono di essere innocenti, tutti tranne lui, che proprio non può e non vuole. Sanno ormai chi è e lui ha paura che minimo minimo lo uccidano da un momento a quello prima, e non si muove dal lettino da giorni senza più tempo. Grida soffocate, nei corridoi, nei cortili, nella sua testa, e dallo spioncino una rete, alle finestre un intrico di reti, reticoli dovunque assalgono gli occhi, chiusi fra le loro feritoie. Il cibo ha un puzzo orrido e arcano che nemmeno Dante si sarebbe figurato, e le sue mani stringono imploranti Famiglia Cristiana. In crisi di conversione, non sa se dorme o se è desto, non vuole più parlare, mai più con nessuno, solo con Gesù Bambino. Che chissà che gli frega di uno stronzo del genere. O forse si. Massì, dai, si. Tanto, per quello che può servire…</p>
<p>Ritrovata la pistola, registrata dal padre di Lele, si palesa tutta la merda della vicenda. Seguono processi che non finiranno mai, mentre sorgono centri culturali dedicati ad Abdull gestiti da bianchi, e gruppi eversivi, sempre più bianchi, di camerati a favore di Porcoskin libero, e le cazzatone dei giornalisti prosperano alla grande.</p>
<p>Il sole implacabile secca le piante più deboli. Non vuole piovere. Non vuole proprio. Ma proprio no.</p>
<p>•</p>
<p><em>Tratto da: Claudio Comandini, Basso Impero, Sovera Roma 2006, pp.&nbsp;60-62.</em></p>
<p><em>Musica: L’Italia ha vinto (Comandini), registrata al Sound Club di Marino da Ernesto Ranieri nel maggio 2007. Claudio Comandini: voce, tromba, elettronica - Caterina Rosolino: kora - Ernesto Ranieri: chitarra elettrica - Francesco Ranieri: basso elettrico, batteria, percussioni.</em></p>
<p><em>Fotografia: Claudio Comandini, “Forza, Italia” - Bologna-Roma 2011</em></p>


</main> 
  </div>
</div>
 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiato!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiato!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/grandtour\.shop");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>